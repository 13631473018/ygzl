$(function(){var a=false;var b;var c=function(){var F=parseInt($("#hidShopMoney").val());var e=$("#hidBalance").val();var B=parseInt($("#hidPoints").val());var d=$("#spPoints");var u=$("#spBalance");var i=null;var r=$("#bankList");var x="";var z=$("#hidIsBuyNext").val();var G=function(H){$.PageDialog.fail(H)};var j=function(I,H){$.PageDialog.ok(I,H)};var h=parseInt(B/100)>F?F:parseInt(B/100);var E=0;var f=0;if(h<F){var n=parseInt(e);if(n>0){var l=F-h;if(n>=l){E=l}else{E=n;f=l-n}}else{f=F-h}}var w=function(H){h=H;if(H>0){d.parent().removeClass("z-pay-grayC");d.attr("sel","1").attr("class","z-pay-mentsel").next("span").html('福分支付<em class="orange">'+H+".00</em>元（您的福分："+B+"）")}else{d.attr("sel","0").attr("class","z-pay-ment").next("span").html('福分支付<em class="orange">0.00</em>元（您的福分：'+B+"）")}};var g=function(H){E=H;if(H>0){u.parent().removeClass("z-pay-grayC");u.attr("sel","1").attr("class","z-pay-mentsel").next("span").html('余额支付<em class="orange">'+H+".00</em>元（账户余额："+e+" 元）")}else{u.attr("sel","0").attr("class","z-pay-ment").next("span").html('余额支付<em class="orange">0.00</em>元（账户余额：'+e+" 元）")}};var p=function(H){f=H;if(H>0){i.html('<s class="z-arrow"></s>选择'+(x=="网银"?"网银":'<b class="z-mlr">'+x+"</b>")+"支付"+((h>0||E>0)?"剩余":"")+'<em class="orange">'+f+".00</em>元");i.removeClass("z-pay-grayC").nextAll().show();t=true}else{i.addClass("z-pay-grayC").html('<s class="z-arrow"></s>选择网银支付').nextAll().hide();t=false}};if(parseInt(B/100)>0){d.parent().click(function(){p(0);if(d.attr("sel")==1){w(0);s(F)}else{var H=parseInt(B/100);if(H>0){w(H>=F?F:H);s(H>=F?0:F-H)}else{s(F)}}});var s=function(I){if(u.attr("sel")==1){var H=parseInt(e)-I;if(H>0){g(I)}else{g(parseInt(e));p(-H)}}else{p(I)}}}if(parseInt(e)>0){u.parent().click(function(){p(0);if(u.attr("sel")==1){g(0);q(F)}else{var H=parseInt(e);if(H>0){g(H>=F?F:H);q(H>=F?0:F-H)}else{q(F)}}});var q=function(I){if(d.attr("sel")==1){var H=parseInt(B/100)-I;if(H>0){w(I)}else{w(parseInt(B/100));p(-H)}}else{p(I)}}}var t=false;var D=-1;$("li",r).each(function(H){var I=$(this);if(H==0){i=I;i.click(function(){if(!i.hasClass("z-pay-grayC")){if(!t){i.nextAll().show();t=true}else{i.nextAll().hide();t=false}}})}else{if(I.find("i.z-bank-Roundsel").length>0){D=parseInt(I.attr("type"));x=I.text()}I.click(function(){D=parseInt(I.attr("type"));x=I.text();I.children("i").attr("class","z-bank-Roundsel");I.siblings().each(function(){$(this).children("i").attr("class","z-bank-Round")});i.html('<s class="z-arrow"></s>选择<b class="z-mlr">'+x+"</b>支付"+((h>0||E>0)?"剩余":"")+'<em class="orange">'+f+".00</em>元")})}});if(f>0){i.removeClass("z-pay-grayC").html('<s class="z-arrow"></s>选择<b class="z-mlr">'+x+"</b>支付"+((h>0||E>0)?"剩余":"")+'<em class="orange">'+f+".00</em>元").nextAll().show();t=true}else{i.addClass("z-pay-grayC").nextAll().hide();t=false}var m=function(O,I,J,H,Q){var K=255;var N=130;if(typeof(H)!="undefined"){K=H}if(typeof(H)!="undefined"){N=Q}var P=null;var R='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+O+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">忘记密码</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">重试</a></div></div></div>';var M=function(){var S=$("#pageDialog");S.find("a.z-DefineBtn").click(function(){L.close();if(typeof(I)!="undefined"&&I!=null){I()}});S.find("a.z-CloseBtn").click(function(){L.cancel();if(typeof(J)!="undefined"&&J!=null){J()}})};var L=new $.PageDialog(R,{W:K,H:N,close:true,autoClose:false,ready:M})};var o=function(I){var H=function(L,M,J){var K=new RegExp(M,"g");return L.replace(K,J)};var I=escape(I);I=H(I,"\\+","%2B");I=H(I,"/","%2F");return I};var k=["","","","","","",""];var y;var v=function(K){var Q=0;var M;var O=function(S,R){return Math.random()>0.5?-1:1};var H=function(){var S='<div class="pop-pay-pwd clearfix">';S+="<dl>";S+='<dt class="gray3">请输入支付密码</dt>';S+='<dd id="ddpwd">';S+="<span><em></em></span><span><em></em></span><span><em></em></span><span><em></em></span><span><em></em></span><span><em></em></span>";S+="</dd>";S+="</dl>";S+='<ul class="pop-pay-pwd clearfix" id="input_pwd">';var T=["<li><a>0</a></li>","<li><a>1</a></li>","<li><a>2</a></li>","<li><a>3</a></li>","<li><a>4</a></li>","<li><a>5</a></li>","<li><a>6</a></li>","<li><a>7</a></li>","<li><a>8</a></li>","<li><a>9</a></li>"];var U=T.sort(O);var R=U.length-1;var V=U[R];U.splice(R,1,'<li><a id="a_del">清除</a></li>',V);S+=U.join("");S+='<li><a id="a_close">关闭</a></li>';S+="</ul>";S+="</div>";return S};var P=function(){if(!(parseInt(k[0])>=0&&parseInt(k[0])<10)){return false}if(!(parseInt(k[1])>=0&&parseInt(k[1])<10)){return false}if(!(parseInt(k[2])>=0&&parseInt(k[2])<10)){return false}if(!(parseInt(k[3])>=0&&parseInt(k[3])<10)){return false}if(!(parseInt(k[4])>=0&&parseInt(k[4])<10)){return false}if(!(parseInt(k[5])>=0&&parseInt(k[5])<10)){return false}if(typeof(K)!="undefined"&&K!=null){K()}};var N;var I=function(R){if(Q>5){return false}var S=parseInt(R.children("a").html());if(S>=0&&S<10){N.eq(Q).html("●");k[Q]=S;Q++}P()};var J=function(){b.resetFun()};var L=function(){y=$("#pageDialog");var S=$("#a_close",y);var R=$("#a_del",y);N=$("#ddpwd",y).find("em");b.resetFun();$("#input_pwd",y).children("li").each(function(){var T=parseInt($(this).children("a").html());if(T>=0&&T<10){$(this).bind("click",function(){I($(this))})}});S.click(function(){M.cancel()});R.click(function(){J()})};this.closeFun=function(){if(M){M.close()}};this.initFun=function(){var S=$(document.body).width()>900?900:$(document.body).width();var R=S*0.8;M=new $.PageDialog(H(),{W:R,H:335,close:true,autoClose:false,ready:L})};this.resetFun=function(){Q=0;$(k).each(function(R){k[R]="";N.eq(R).html("")})}};var A=$("#btnPay");var C=function(){if(!a){return}var I=function(){if(E>0||h>0){var K=function(){var L=function(){var N=k.join("");if(N.length==6){var M=function(Q){if(Q.state==0||Q.state==-4){b.closeFun();H(Q.str)}else{if(Q.state==1){if(Q.num==-4){j("密码错误次数超限，已冻结！",function(){b.closeFun()})}else{b.closeFun();var P=function(){location.href="/member/PayPwdCheck.do?update=1&forward="+o("/mycart/payment.do")};var O=function(){b.initFun()};m("支付密码错误，还可输入"+Q.str+"次！",O,P)}}else{j("支付异常,请刷新重试[2]！",function(){location.reload()})}}};GetJPData("https://passport.1yyg.com","checkUPaypwd","paypwd="+N,M)}};b=new v(L);b.initFun()};var J=function(L){if(L.state==0){H("")}else{if(L.state==1){K()}else{if(L.state==-4||L.state==10){location.reload()}else{G("支付异常,请刷新重试[1]！")}}}};GetJPData("https://passport.1yyg.com","checkUPay","point="+(h*100)+"&isBalance="+(E>0?1:0),J)}else{H("")}};var H=function(L){if(E+h>=F){a=false;A.unbind("click").attr("class","grayBtn").html("正在支付,请稍等..");var K=function(M){if(M.state==0){location.replace("http://m.1yyg.com/mycart/shopok.do?id="+M.str);return}else{if(M.state==10){location.reload()}else{if(M.state==1||M.state==4){j("已抢光啦，您下手太慢了噢！",function(){location.reload()})}else{j("提交失败，请重试！",function(){location.reload()})}}}A.bind("click",C).attr("class","orgBtn").html("确认支付");a=true};GetJPData("http://trade.1yyg.com/JPData/API.ashx","UserPay","integral="+(h*100)+"&isBalance="+(E>0?1:0)+"&device=1&checkSN="+L+"&isBuyNext="+z,K)}else{if(f>0){var J="";if(D==1){J="wangyin"}else{if(D==2){J="cmbchina"}else{if(D==3){J="unionpay"}else{if(D==4){J="quickpay"}else{G("请选择支付方式！");return}}}}location.href=J+".do?useBalance="+(E>0?1:0)+"&integral="+(h*100)+"&checkSN="+L+"&isBuyNext="+z}}};I()};A.bind("click",C);a=true};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=130826",c)});