$(function(){var a=$("#divGoodsNav");var c=$("#divGoodsLoading");var h=$("#btnLoadMore");var d=null;var e=10;var g=0;var b=$("#hidOrderFlag").val();var f={sortID:0,brandID:0,orderFlag:b,FIdx:1,EIdx:e,isCount:1};var j=false;var i=function(){var q=new $CartComm();var m=function(u){if(u&&u.stopPropagation){u.stopPropagation()}else{window.event.cancelBubble=true}};var k=false;var s=false;a.children("li").each(function(){var v=$(this);var u=v.attr("order");if(u!=""){if(b==u){v.addClass("current").siblings().removeClass("current")}v.click(function(){v.addClass("current").siblings().removeClass("current");u=v.attr("order");f.orderFlag=u;if(f.orderFlag==31){v.attr("order","30").html('<a href="javascript:;">价值<em class="orange"></em><s></s><b></b></a>')}else{if(f.orderFlag==30){v.attr("order","31").html('<a href="javascript:;">价值<em></em><s class="orange"></s><b></b></a>')}else{v.siblings('li[type="price"]').attr("order","31").html('<a href="javascript:;">价值<em></em><s></s><b></b></a>')}}d.getInitPage()})}else{v.click(function(w){m(w);if(k){v.removeClass("gSort").parent().next().hide();v.parent().next().hide();k=false}else{k=true;v.addClass("gSort").parent().next().show();if(!s){v.parent().next().find("li").each(function(){var x=$(this);x.click(function(y){m(y);f.sortID=x.attr("type");x.addClass("current").siblings().removeClass("current");x.parent().parent().hide();v.removeClass("gSort");k=false;v.children("a").html(x.text()+'<s class="arrowUp"></s>');d.getInitPage()})});s=true}}})}});$("#loadingPicBlock").click(function(){a.children("li").last().removeClass("gSort").children("dl").css("display","none");k=false});var l=function(u){$.PageDialog.fail(u)};var o=function(u){$.PageDialog.ok("<s></s>"+u)};var p=function(u){$.PageDialog('<div class="Prompt">'+u+"</div>",{W:150,H:45,close:false,autoClose:true,submit:function(){location.reload()}})};var t=function(B,v,w,u,D){var x=255;var A=126;if(typeof(u)!="undefined"){x=u}if(typeof(u)!="undefined"){A=D}var C=null;var E='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+B+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">取消</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">确定</a></div></div></div>';var z=function(){var F=$("#pageDialog");F.find("a.z-DefineBtn").click(function(){if(typeof(v)!="undefined"&&v!=null){v()}y.close()});F.find("a.z-CloseBtn").click(function(){if(typeof(w)!="undefined"&&w!=null){w()}y.cancel()})};var y=new $.PageDialog(E,{W:x,H:A,close:true,autoClose:false,ready:z})};var r=function(w,v,u){q.addShopCart(v,u,function(x){if(x.code==0){addNumToCartFun(x.num);o("添加成功")}else{if(x.code==1){if(x.num==0){p("啊哦~！被抢光啦！")}else{var B=w.parent().parent();var z=x.str;if(z!=""){var D=z.split("|");if(D!=null&&D.length==6){var A=function(){w.attr("codeid",D[0]);B.find("h2").find("em").html(D[1]);B.find("span.pgbar").attr("style","width:"+D[5]+"%");B.find(".P-bar01").find("em").html(D[2]);B.find(".P-bar02").find("em").html(D[3]);B.find(".P-bar03").find("em").html(D[4])};var y=function(){A();r(w,D[0],u)};var C=function(){A()};t("本云已满员，是否云购下一云？",y,C)}}else{l("本商品已结束");B.find("span.pgbar").attr("style","width:100%");B.find(".P-bar01").find("em").html(B.find(".P-bar02").find("em").html());B.find(".P-bar03").find("em").html("0")}}}else{if(x.code==2){l("哎呀！购物车满啦，删除一些吧！",300)}else{if(x.code==3){l("您参与人次已达上限！")}else{l("添加失败，请重试["+x.code+"]")}}}}})};$("div.goodsList").find("div.pRate").each(function(){var u=$(this);u.children("a.add").each(function(){$(this).click(function(w){m(w);var v=$(this);r(v,v.attr("codeid"),1)})})});var n=function(){var u=function(){return"sortID="+f.sortID+"&brandID="+f.brandID+"&orderFlag="+f.orderFlag+"&FIdx="+f.FIdx+"&EIdx="+f.EIdx+"&isCount="+f.isCount};var v=function(){c.show();GetJPData("http://m.1yyg.com","getGoodsPageList",u(),function(y){if(y.code==0){var x=y.listItems;if(f.isCount==1){g=y.count;f.isCount=0}var B=x.length;var C=0;var E=0;var w=0;var F=0;for(var z=0;z<B;z++){var A='<ul id="'+x[z].goodsID+'"><li><span class="z-Limg"><img src="'+Gobal.LoadPic+'" src2="http://mimg.1yyg.com/GoodsPic/pic-200-200/'+x[z].goodsPic+'">';if(x[z].codeType==1){A+='<div class="pTitle pLimitedTime">限时</div>'}else{switch(x[z].goodsTag){case 1:A+='<div class="pTitle pNewProducts">新品</div>';break;case 2:A+="";break;case 3:A+='<div class="pTitle pPopularity">人气</div>';break;case 10:A+='<div class="pTitle pPurchase">限购</div>';break}}A+='</span><div class="goodsListR"><h2>(第<em>'+x[z].codePeriod+"</em>云)"+x[z].goodsSName+"</h2>";C=parseInt(x[z].codeSales);E=parseInt(x[z].codeQuantity);w=parseInt(E-C);F=parseInt(C*100)/E;F=C>0&&F<1?1:F;A+='<div class="pRate"><div class="Progress-bar"><p class="u-progress">'+(C>0?'<span style="width:'+F+'%;" class="pgbar"><span class="pging"></span></span>':"")+'</p><ul class="Pro-bar-li"><li class="P-bar01"><em>'+C+'</em>已参与</li><li class="P-bar02"><em>'+E+'</em>总需人次</li><li class="P-bar03"><em>'+w+'</em>剩余</li></ul></div><a href="javascript:;" codeid="'+x[z].codeID+'" class="add '+(w==0?"gray":"")+'"><s></s></a></div></div></li></ul>';var D=$(A);D.click(function(){location.href="/products/"+$(this).attr("id")+".html"}).find("div.pRate > a").each(function(){var G=$(this);G.click(function(H){m(H);if(!G.hasClass("gray")){r(G,G.attr("codeid"),1)}})});c.before(D)}if(f.EIdx<g){j=false;h.show()}loadImgFun(0)}else{if(f.FIdx==1){c.before(Gobal.NoneHtml)}}c.hide()})};this.getInitPage=function(){f.FIdx=1;f.EIdx=e;f.isCount=1;g=0;c.prevAll().remove();h.hide();v()};this.getFirstPage=function(){v()};this.getNextPage=function(){f.FIdx+=e;f.EIdx+=e;v()}};h.click(function(){if(!j){j=true;h.hide();d.getNextPage()}});d=new n();d.getFirstPage()};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=130826",function(){Base.getScript(Gobal.Skin+"/JS/CartComm.js?v=160523",i)})});